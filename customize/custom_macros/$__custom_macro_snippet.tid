created: 20211127060449171
creator: yuzijie
keywords: snippets
modified: 20220910165750755
modifier: yuzijie
tags: $:/tags/Macro customized
title: $:/custom/macro/snippet
type: text/vnd.tiddlywiki

\define snippet-drop-ctrl-actions(tag)
<$action-createtiddler $basetitle=<<unusedtitle $(template)$>> $template=<<actionTiddler>> date=<<now YYYY0MM0DD>> belongs.to=<<currentTiddler>> note=<<key>> keywords=<<keywords>> parents=<<parents>> caption="$(caption)$âœ±">
<$action-listops $tiddler=<<createTiddler-title>> $field="tags" $subfilter="Snippet [<__tag__>]"/>
</$action-createtiddler>
\end

\define snippet-drop-actions(actions, tag)
<$vars template={{{ [<actionTiddler>split[ ]first[]] }}} caption={{{ [<actionTiddler>get[caption]] }}}>
<$set name="parents" filter="[<currentTiddler>getAllParents[]]">
<$set name="keywords" filter="[<currentTiddler>getAllParentTitles[]join[, ]]" select="0">
<$list filter="[<modifier>!match[ctrl]]" emptyMessage=<<snippet-drop-ctrl-actions "$tag$">> variable="NONE">
<$action-setfield $tiddler=<<actionTiddler>> $timestamp="no" belongs.to=<<currentTiddler>> note=<<key>> keywords=<<keywords>> parents=<<parents>>/>
<$action-listops $tiddler=<<actionTiddler>> $field="tags" $subfilter="Snippet [<__tag__>]" $timestamp="no"/>
<$macrocall $name="tiddler-close" tiddler=<<actionTiddler>>/>
</$list>
<<__actions__>>
</$set>
</$set>
</$vars>
\end

\define snippet-limit-state() $:/state/snippet-limit/$(current)$/$(key)$
\define snippet-accordion-state() $:/state/snippet-accordion/$(current)$/$(currentTiddler)$

\define snippet-content(date, sort, limit, caption, cfilter, rheader, no-drop)
<$list filter="[<snippet-qty>compare:number:gt<__limit__>] :else[prefix<f>limit[1]]" variable="NONE"><div class="filter-options" style="margin:3px 0;">
filter <$macrocall $name="list-filters" title=<<key>> filter=<<filter-build "[belongs.to<currentTiddler>tag[Snippet]note<key>]" "+[$sort$]">>/>
</div></$list>
<$list filter="[<__cfilter__>is[blank]]" emptyMessage="""<$macrocall $name="table" cfilter=<<__cfilter__>> rfilter=<<filter-build "[belongs.to<currentTiddler>tag[Snippet]note<key>!has[draft.of]]" "+[$sort$limit<limit>]">> rheader=<<__rheader__>>/>""" variable="NONE">
<$list filter=<<filter-build "[belongs.to<currentTiddler>tag[Snippet]note<key>!has[draft.of]]" "+[$sort$limit<limit>]">> emptyMessage="""<$list filter="[<__no-drop__>!match[yes]]">@@color:red;Drop Tiddler Here@@</$list>"""><div class="snippet">
<$button class="tc-btn-invisible links" style="fill:#999;font-size:small;">
<$list filter="[<snippet-accordion-state>is[missing]]" emptyMessage="{{$:/core/images/down-arrow}}<$action-deletetiddler $tiddler=<<snippet-accordion-state>>/>" variable="NONE">
{{$:/core/images/right-arrow}}<$action-setfield $tiddler=<<snippet-accordion-state>> text="open"/>
</$list>
</$button>
<$set name="direct-open" value="yes"><<links>>
<$button actions=<<modal-actions>> dragTiddler=<<currentTiddler>> class="tc-btn-invisible tc-tiddlylink snippet-title" tooltip=<<currentTiddler>>>
<$list filter="[all[current]has[status]]">@@color:red;[{{!!status}}]@@</$list>
<$list filter="[<__caption__>!is[blank]]" variable="NONE" emptyMessage="<$transclude field=caption>Content</$transclude>"><<__caption__>></$list>
<$list filter="[tag[Comment]belongs.to{!!title}]">@@color:red;+ Comments@@</$list>
<$reveal default="$date$" type="match" text="yes" style="color:#aaa;">
(<$view field="date" format="date" template="YYYY-0MM-0DD"><$view field="modified" format="date" template="YYYY-0MM-0DD"/></$view>)
</$reveal>
<$list filter="[all[current]!is[system]search:title:literal[/]]">@@font-size:small;ğŸŒ¿@@</$list>
<$list filter="[all[current]has[description]]">@@color:#aaa;- {{!!description}}@@</$list>
</$button>
</$set>
<$reveal type="match" state=<<snippet-accordion-state>> text="open" tag="div" class="snippet-accordion"><$set name="key" value="">
<$list filter="[all[current]!type[text/plain]]" emptyMessage="<$codeblock code={{!!text}} language={{!!language}}/>">
<$list filter="[all[current]!type[application/x-tiddler-dictionary]]" emptyMessage=<<data-table copy:no>>>
<$set name="class" filter="[all[current]has[_canonical_uri]] [all[current]is[image]]" value="snippet-external" emptyValue="snippet-content"><div class=<<class>>><$transclude mode="block"/></div></$set>
</$list>
</$list>
</$set></$reveal>
</div></$list>
</$list>
<$list filter="[<snippet-qty>compare:number:gt<__limit__>]" variable="NONE"><div class="tc-menu-list-item" style="margin-top:-3px;">
<$button class="tc-btn-invisible fold-text">-- <<limit>> of <<snippet-qty>> shown --
<$list filter="[<snippet-limit-state>is[missing]]" emptyMessage="<$action-deletetiddler $tiddler=<<snippet-limit-state>>/>">
<$action-setfield $tiddler=<<snippet-limit-state>> text=<<snippet-qty>>/>
</$list>
</$button>
</div></$list>
\end

\define snippet-item-filter() belongs.to[$(current)$]tag[Snippet]note[$(key)$]

\define cat-modal(mTitle, item-filter, sort, cfilter, rheader, cat-prefix, cat-algorithm, cat-caption, search)
<$set name="qty" filter="[$item-filter$!has[draft.of]$sort$count[]]" select="0">
<$button dragFilter="[$item-filter$]" class="tc-btn-invisible tc-tiddlylink">
<$list filter="[[$(modal)$]match[yes]]" variable="NONE">
<$macrocall $name="tiddler-open" tiddler=<<mTitle>>/><$action-sendmessage $message="tm-close-tiddler" $param=<<current>>/>
</$list>
<$action-sendmessage $message="tm-modal" $param="$:/custom/template/category-modal" mTitle=<<__mTitle__>> item-filter=<<__item-filter__>> cat-prefix=<<cat-prefix>> sort=<<__sort__>> cfilter=<<__cfilter__>> rheader=<<__rheader__>> cat-algorithm=<<__cat-algorithm__>> qty=<<qty>> cat-caption=<<__cat-caption__>> search=<<__search__>>/>
<$list filter="[<__cat-caption__>!is[blank]]" emptyMessage="Total of <<qty>> items"><<__cat-caption__>> <span style="color:#aaa;">(<<qty>>)</span></$list>
</$button>
</$set>
\end

\define snippet(key, date:"no", sort:"sortan[title]", limit:"30", caption, cfilter, rheader, actions, tag, no-drop, cat-prefix, cat-algorithm, cat-caption)
<$set name="key" filter="[[$key$]is[blank]]" value="$(key)$" emptyValue=<<__key__>>><$set name="current" value=<<currentTiddler>>>
<$droppable actions=<<snippet-drop-actions """$actions$""" """$tag$""">> tag="div" class="snippet-container">
<div class="tc-droppable-placeholder" style="display:block;">
<$list filter="[<__cat-prefix__>is[blank]]" emptyMessage="""<$macrocall $name="cat-modal" mTitle=<<current>> item-filter=<<snippet-item-filter>> sort="$sort$" cfilter="$cfilter$" rheader="$rheader$" cat-prefix="$cat-prefix$" cat-algorithm="$cat-algorithm$" cat-caption="$cat-caption$"/>""" variable="NONE">
<$set name="f" filter="[[$:/state/select/]addsuffix<currentTiddler>addsuffix[/]addsuffix<key>]" select="0">
<$vars f2={{{ [<f>addsuffix[/1]get[text]] }}} f3={{{ [<f>addsuffix[/2]get[text]] }}} f4={{{ [<f>addsuffix[/3]get[text]] }}}>
<$set name="snippet-qty" filter=<<filter-build "[belongs.to<currentTiddler>tag[Snippet]note<key>!has[draft.of]]" "+[$sort$count[]]">> select="0">
<$set name="limit" filter="[<snippet-limit-state>get[text]]" emptyValue=<<__limit__>> select="0">
<$macrocall $name="snippet-content" date=<<__date__>> sort=<<__sort__>> limit=<<__limit__>> caption=<<__caption__>> cfilter=<<__cfilter__>> rheader=<<__rheader__>> no-drop=<<__no-drop__>>/>
</$set>
</$set>
</$vars>
</$set>
</$list>
</div>
</$droppable>
</$set></$set>
\end

# ''æŒ‰ä½ Ctrl å¹¶æ‹–åˆ° Snippet ä¸Šå¤åˆ¶å½“å‰ Tiddler''<$macrocall $name="code" content="""<<snippet-drop-ctrl-actions tag:"é¢å¤–æ·»åŠ çš„æ ‡ç­¾">>"""/>
# ''æ‹–åˆ° Snippet ä¸Šå‘ç”Ÿçš„åŠ¨ä½œ''<$macrocall $name="code" content="""<<snippet-drop-actions actions:"Tiddler è¢«æ”¾ç½®æ—¶çš„é¢å¤–åŠ¨ä½œ" tag:"é¢å¤–æ·»åŠ çš„æ ‡ç­¾">>"""/>
# ''Snippet çš„æ¡ç›®''<$macrocall $name="code" content="""<<snippet-content date:"æ—¥æœŸ yes/no" sort:"Snippets æ’åº" limit:"ä¸€æ¬¡æœ€å¤šåˆ—å‡ºçš„ Snippets çš„æ•°é‡" caption:"è‡ªå®šä¹‰æ˜¾ç¤ºæ¡ç›®çš„å†…å®¹" cfilter:"å¦‚æœå¡«å†™è‡ªåŠ¨åˆ‡æ¢åˆ° Table æ¨¡å¼" rheader:"å¦‚æœæ˜¯ Table æ¨¡å¼å¯ä»¥é€‰å¡«" no-drop:"æ²¡æœ‰ snippet æƒ…å†µä¸‹, ä¸æ˜¾ç¤º Drop Tiddler Here">>"""/>
# ''åœ¨ä¸€ä¸ª Modal é‡Œé¢æ˜¾ç¤ºæ‰€æœ‰çš„ Snippets''<$macrocall $name="code" content="""<<snippet-modal sort:"Snippets æ’åº" cfilter:"å¦‚æœå¡«å†™è‡ªåŠ¨åˆ‡æ¢åˆ° Table æ¨¡å¼" rheader:"å¦‚æœæ˜¯ Table æ¨¡å¼å¯ä»¥é€‰å¡«" cat-prefix:"tag çš„å‰ç¼€" cat-algorithm:"å¦‚ä½•ç”Ÿæˆ tag çš„ filter" cat-caption:"è‡ªå®šä¹‰æŒ‰é’®æ ‡é¢˜" >>"""/>
# ''åˆ›å»ºä¸€ä¸ªæ–°çš„ Snippet æˆ–æŸ¥çœ‹å·²åˆ›å»ºçš„ Snippet''<$macrocall $name="code" content="""<<snippet key:"index key" date:"æ—¥æœŸ yes/no" sort:"Snippets æ’åº" limit:"ä¸€æ¬¡æœ€å¤šåˆ—å‡ºçš„ Snippets çš„æ•°é‡" caption:"è‡ªå®šä¹‰æ˜¾ç¤ºæ¡ç›®çš„å†…å®¹" cfilter:"å¦‚æœå¡«å†™è‡ªåŠ¨åˆ‡æ¢åˆ° Table æ¨¡å¼" rheader:"å¦‚æœæ˜¯ Table æ¨¡å¼å¯ä»¥é€‰å¡«" actions:"Tiddler è¢«æ”¾ç½®æ—¶çš„é¢å¤–åŠ¨ä½œ" tag:"Tiddler è¢«æ”¾ç½®æ—¶æ·»åŠ é¢å¤–æ ‡ç­¾" no-drop:"æ²¡æœ‰ snippet æƒ…å†µä¸‹, ä¸æ˜¾ç¤º Drop Tiddler Here" cat-prefix:"tag çš„å‰ç¼€" cat-algorithm:"å¦‚ä½•ç”Ÿæˆ tag çš„ filter" cat-caption:"è‡ªå®šä¹‰æŒ‰é’®æ ‡é¢˜">>"""/>